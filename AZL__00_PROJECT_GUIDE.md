# AZL — инструкция проекта (работа с файлами через бандлы)

Обновлено: 2026-01-11

## 0) Зачем это нужно
В ChatGPT Project файлы отображаются плоским списком, а в Obsidian у Вовы — древовидная структура.
Мы решаем это так:
- В ChatGPT храним **плоские** файлы с кодированным путём в имени (`AZL__...`).
- На ПК Вовы скрипт раскладывает файлы в дерево папок по карте кодов.

Ключевое правило: **локальный Obsidian = GPT‑проект по набору файлов** (разница только в структуре папок).

---

## 1) Формат имён файлов (AZL)
**Базовый формат:**
`AZL__<CODE1>__<CODE2>__...__<FILENAME>`

- `AZL__` — префикс.
- Каждый `<CODE>` — 4 символа Base32 Crockford (0–9, A–Z без I/L/O, но мы допускаем общий набор `0-9A-Z`).
- Максимальная глубина: **6 кодов**.
- `<FILENAME>` — человекочитаемое имя файла (можно по‑русски), расширение любое (`.md`, `.txt`, `.json`).

Пример:
`AZL__9M3R__2T7P__Калигни__численность_и_гвардия_Ширанны.md`

---

## 2) Обязательные файлы в бандле
Бандл — это ZIP, который ChatGPT отдаёт Вове для синхронизации.

**Имя ZIP:**
- всегда `AZL__BUNDLE.zip`
- допустимы варианты Windows: `AZL__BUNDLE (1).zip`, `AZL__BUNDLE (123).zip`

**Содержимое ZIP (минимум):**
1) `AZL__00_CODES.json` — карта кодов → названия папок и parent‑связи.
2) `AZL__MANIFEST.json` — *опционально*, операции delete/move (может быть пустым).
3) Любые файлы `AZL__...` — контент.

---

## 3) Карта кодов (AZL__00_CODES.json)
JSON вида:
```json
{
  "version": 1,
  "updated": "YYYY-MM-DD",
  "codes": {
    "9M3R": { "folder": "Сюжет кампании", "parent": null },
    "2T7P": { "folder": "Арка-1", "parent": "9M3R" }
  }
}
```

- `folder` — имя папки в Obsidian.
- `parent` — код родителя или `null`.
- Если код в имени файла не найден — файл попадает в `_UNMAPPED/<CODE>/...`

---

## 4) Manifest (AZL__MANIFEST.json)
Manifest нужен **только для операций**, которые нельзя выразить “просто залей новый файл”:
- `delete` (удалить файл)
- `move/rename` (перенести/переименовать)

Минимально валидный пустой манифест:
```json
{
  "version": 1,
  "ops": []
}
```

Рекомендуется использовать `coded`, чтобы мы могли дать корректные подсказки по GPT‑проекту:
```json
{
  "version": 1,
  "ops": [
    { "op": "delete", "coded": "AZL__9M3R__2T7P__Старый_файл.md" },
    {
      "op": "move",
      "from": { "coded": "AZL__9M3R__2T7P__Было.md" },
      "to":   { "coded": "AZL__9M3R__2T7P__Стало.md" }
    }
  ]
}
```

---

## 5) Скрипт на ПК (раскладка бандла)
На ПК Вовы есть скрипт, который:
1) Ищет в Downloads последний `AZL__BUNDLE*.zip`
2) Распаковывает рядом со скриптом в `_AZL_STAGING`
3) Если в ZIP есть `AZL__00_CODES.json` — копирует в корень Obsidian с заменой
4) Читает коды
5) Применяет `AZL__MANIFEST.json` локально (delete/move)
6) Раскладывает все `AZL__*` файлы в дерево папок с перезаписью
7) Печатает инструкции “что удалить/что добавить” для GPT‑проекта
8) Ждёт Enter → удаляет staging

Важно: если файл уже существует локально — он **перезаписывается**, без суффиксов.

---

## 6) Команды для работы в чате (человеческие)
### 6.1 «Собери бандл»
Ожидаемое поведение ассистента:
- обновить/создать нужные `AZL__...` файлы в Project files (плоско)
- собрать ZIP `AZL__BUNDLE.zip`, в котором:
  - `AZL__00_CODES.json`
  - `AZL__MANIFEST.json` (даже если пустой)
  - все изменённые/новые `AZL__...` файлы

### 6.2 «Проверить» / «Провалидировать»
Ожидаемое поведение ассистента:
1) Просканировать **все project files**, которые начинаются с `AZL__`
2) Построить дерево папок из кодов по `AZL__00_CODES.json`
3) Выдать отчёт:
   - **Ошибки**
     - нет `AZL__00_CODES.json` или их несколько
     - файл `AZL__...` не парсится (коды не 4 символа / слишком много сегментов / нет имени после кодов)
     - код используется в имени файла, но отсутствует в `codes`
     - `parent` в карте кодов противоречит порядку сегментов (warning)
   - **Дубли**
     - файлы с одинаковым именем в GPT‑проекте (это признак, что не удалили старый перед загрузкой)
   - **Сводка**
     - сколько файлов в каждой “папке” (по дереву)
     - список файлов, попавших в `_UNMAPPED`
4) Дать “что делать дальше”:
   - какие файлы удалить как дубликаты
   - какие коды добавить/поправить в `AZL__00_CODES.json`

---

## 7) Где лучше хранить правила: в промпте проекта или в файле?
Рекомендуемый подход:
- **В промпте проекта** держать короткий “bootstrap” (3–10 строк): главные инварианты + имя файла‑инструкции.
- **Основные правила** — в отдельном project file `AZL__00_PROJECT_GUIDE.md` (этот файл).

Так меньше риск упереться в лимиты инструкций/контекста, и правила можно обновлять через бандлы.

---

## 8) Имена “служебных” файлов
- `AZL__00_CODES.json` — карта кодов
- `AZL__MANIFEST.json` — операции (может быть пустым)
- `AZL__00_PROJECT_GUIDE.md` — эта инструкция
